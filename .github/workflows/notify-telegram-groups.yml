name: Notify Telegram Groups

# Manually trigger this workflow here: https://github.com/pokt-network/poktroll/actions/workflows/notify-telegram-groups.yml
on:
  workflow_dispatch:
  # Uncomment the lines below to automatically trigger on release publication
  # This is commented out to avoid premature notifications
  # release:
  #   types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    # Uncomment the line below when enabling automatic triggers
    # if: github.event.release.prerelease == false
    steps:
      - name: Get latest release
        id: get_release
        run: |
          # Get latest release info from GitHub API
          RELEASE_INFO=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/releases/latest")

          # Extract release details and properly escape for GitHub Actions
          RELEASE_NAME=$(echo "$RELEASE_INFO" | jq -r '.name')
          RELEASE_URL=$(echo "$RELEASE_INFO" | jq -r '.html_url')

          echo "Latest release: $RELEASE_NAME"
          echo "Release URL: $RELEASE_URL"

          # Handle multiline release body properly
          echo "release_name=$RELEASE_NAME" >> $GITHUB_OUTPUT
          echo "release_url=$RELEASE_URL" >> $GITHUB_OUTPUT

          # Use EOF delimiter for multiline content
          echo "release_body<<EOF" >> $GITHUB_OUTPUT
          echo "$RELEASE_INFO" | jq -r '.body' >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Send release to Telegram groups
        run: |
          # Pocket Network Bot Testing Group
          CHAT_1="-1002895286734"

          # BitGet <> Pocket Network (POKT)
          CHAT_2="-4954094158"

          # ByBit <> POKT
          CHAT_3="-1002730340404"

          # CoinEx <> POKT
          CHAT_4="-1001946726820"

          # Mr. Yang <> Grove / POKT
          CHAT_5="-1002038833795"

          # MEXC <> POKT
          CHAT_6="-1002815210935"

          # OKX <> Pocket Network
          CHAT_7="-1001901668586"

          # OrangeX <> Grove (POKT)
          CHAT_8="-1002030782436"

          # POKT & Gate.io
          CHAT_9="-1001717732565"

          # POKT Network | AscendEX
          CHAT_10="-4565872373"

          # Use latest release details
          MESSAGE="ðŸ“£ The *${{ steps.get_release.outputs.release_name }} release is live! ðŸ“£ *\n[View the full release here](${{ steps.get_release.outputs.release_url }}).\n\n${{ steps.get_release.outputs.release_body }}"

          # Send to Pocket Network Bot Testing Group
          echo "Sending to Pocket Network Bot Testing Group ($CHAT_1)"
          curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
            -d chat_id="$CHAT_1" \
            -d text="$MESSAGE" \
            -d parse_mode="Markdown"

          # Send to BitGet <> Pocket Network (POKT)
          # echo "Sending to BitGet <> Pocket Network (POKT) ($CHAT_2)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_2" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to ByBit <> POKT
          # echo "Sending to ByBit <> POKT ($CHAT_3)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_3" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to CoinEx <> POKT
          # echo "Sending to CoinEx <> POKT ($CHAT_4)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_4" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to Mr. Yang <> Grove / POKT
          # echo "Sending to Mr. Yang <> Grove / POKT ($CHAT_5)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_5" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to MEXC <> POKT
          # echo "Sending to MEXC <> POKT ($CHAT_6)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_6" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to OKX <> Pocket Network
          # echo "Sending to OKX <> Pocket Network ($CHAT_7)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_7" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to OrangeX <> Grove (POKT)
          # echo "Sending to OrangeX <> Grove (POKT) ($CHAT_8)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_8" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to POKT & Gate.io
          # echo "Sending to POKT & Gate.io ($CHAT_9)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_9" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

          # # Send to POKT Network | AscendEX
          # echo "Sending to POKT Network | AscendEX ($CHAT_10)"
          # curl -s -X POST https://api.telegram.org/bot7267336172:AAEYaEeY0i7DfbL7SsRjPf09N67mvLo8WC4/sendMessage \
          #   -d chat_id="$CHAT_10" \
          #   -d text="$MESSAGE" \
          #   -d parse_mode="Markdown"

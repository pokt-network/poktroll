# This Dockerfile is used to build container image for development purposes.
# It intentionally contains no security features, ships with code and troubleshooting tools.

# Runtime-only base (much smaller than golang:)
FROM debian:bookworm-slim

# Minimal, useful tools (leave this lean to avoid bloating layers)
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates curl jq yq net-tools dnsutils rsync bash vim less make \
 && rm -rf /var/lib/apt/lists/*

# Optional: kubectl (the 'kubernetes-client' Debian pkg is not always available)
# Pin a recent stable; change as needed.
RUN curl -L -o /usr/local/bin/kubectl https://dl.k8s.io/release/v1.30.0/bin/linux/amd64/kubectl \
 && chmod +x /usr/local/bin/kubectl

# Copy only prebuilt binaries; the workflow places them in ./bin
COPY bin/pocketd /usr/bin/pocketd
COPY bin/ignite /usr/bin/ignite
# If present (see workflow), include cosmovisor without building it in-image
COPY bin/cosmovisor /usr/bin/cosmovisor

# Make sure theyâ€™re executable even if host perms were weird
RUN chmod +x /usr/bin/pocketd /usr/bin/ignite || true \
 && (test -f /usr/bin/cosmovisor && chmod +x /usr/bin/cosmovisor || true)

# These ports were exposed in your original dev image:
EXPOSE 8545 8546 8547

ENTRYPOINT ["pocketd"]
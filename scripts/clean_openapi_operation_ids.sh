#!/bin/bash
# Clean up verbose operationId values in the OpenAPI spec generated by Ignite CLI.
# Converts 'GithubCompoktNetworkpoktrollMsg_StakeApplication' to 'MsgStakeApplication'.
# Also improves generic Mixin operations to be more descriptive.

set -euo pipefail

if [ $# -lt 1 ]; then
    echo "Usage: $0 <openapi_file>"
    exit 1
fi

INPUT_FILE="$1"
TMP_FILE="${INPUT_FILE}.tmp"

echo "Cleaning operation IDs in: $INPUT_FILE"

# Make a backup just in case
cp "$INPUT_FILE" "${INPUT_FILE}.backup"

# First pass: Remove the GithubCompoktNetworkpoktroll prefix and underscores
# This works for both JSON and YAML files
sed -E 's/"operationId": "GithubCompoktNetworkpoktroll([^"]+)"/"operationId": "\1"/g; s/operationId: GithubCompoktNetworkpoktroll(.+)$/operationId: \1/g' "$INPUT_FILE" | \
sed 's/"operationId": "\([^_]*\)_\([^"]*\)"/"operationId": "\1\2"/g; s/operationId: \([^_]*\)_\(.*\)$/operationId: \1\2/g' > "$TMP_FILE"

# Replace the original file
mv "$TMP_FILE" "$INPUT_FILE"

echo "Operation ID cleaning complete!"

# Clean up backup if successful
rm -f "${INPUT_FILE}.backup"